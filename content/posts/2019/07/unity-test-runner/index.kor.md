---
title: 유니티 테스트 러너 도입기
date: 2019-07-09
authors: [yang.chunung]
---

안녕하세요. 플라네타리움 개발팀 양천웅입니다. 오늘은 [유니티 테스트 러너] 도입 시도에 대한 경험담을 얘기하려합니다.


들어가기 전에
------------

현재 저는 [Libplanet]을 사용하는 블록체인 게임 개발을 하고 있습니다. 팀에 합류한 이후 유니티로 게임을 만든다는 얘기가 나왔을 때는 막연히 '클라이언트 경험이 없는 것도 아니고, 게임도 클라이언트 프로그래밍하듯이 하면 되겠지.'라는 근거없는 자신감을 가지고 시작했습니다.  
처음 프로젝트를 시작했을때는 일정과 유니티에 대한 이해도가 부족한 상황이라 테스트를 포기하고 작업을 진행했지만, 시간이 지날수록 테스트 도입에 대한 필요성이 커졌고 그때 발견한 것이 유니티 테스트 러너였습니다.

유니티 테스트 러너는 유니티에서 자체적으로 제공하는 테스트 도구입니다. [NUnit] 기반의 테스트를 작성 후, `Play Mode, Ediit Mode` 별 테스트 환경을 구축하여[^1] 유니티 에디터에서 테스트를 실행할 수 있습니다.


어셈블리 정의 파일(assembly definition files)
--------------------------------------------------


처음 문서를 보며 테스트 스크립트를 만들었을 때 문제가 있었는데, 다른 라이브러리들은 정상적으로 인식이 되는데 정작 테스트를 해야 하는 게임 쪽 네임스페이스를 인식 못하는 문제가 있었습니다.
원인은 유니티 에디터 실행 시 자동으로 인식되는 `Assembly-CSharp.dll` 과 다르게, 테스트 스크립트안에서는 유니티 프로젝트의 스크립트를 인식 못 하기 때문입니다.

{{<
figure
  src="tests-asmdef.png"
  caption="<b>Tests.asmdef</b> 에 의존성을 추가"
>}}

이 문제를 해결하기 위해서는 프로젝트 스크립트를 정의한 어셈블리 정의 파일을 생성한 후, 테스트용으로 정의된 어셈블리 정의 파일(에디터에서 테스트 러너 생성 시 별도 설정을 하지않았다면 `Assets/Tests/Test.asmdef` 로 생성됩니다.) 에 의존성을 추가해주면 됩니다. 

자세한 내용은 [관련 문서](https://docs.unity3d.com/kr/2018.1/Manual/ScriptCompilationAssemblyDefinitionFiles.html) 를 참고해주세요.


어셈블리 정의 파일의 플랫폼 설정
---------------------------------


어셈블리 정의 파일을 생성한 후에도 문제가 있었는데, 에디터에서는 정상적으로 작동하는 서드파티 라이브러리가 프로젝트 빌드 시에 인식이 안 되면서 깨지는 문제였습니다.
라이브러리가 유니티 에디터의 확장 기능을 제공하는 경우가 있는데, 어셈블리 정의 파일이 에디터용 기능을 빌드에 포함하려다 발생하는 문제였습니다.

{{<
figure
  src="unity-platform.png"
  caption="허용 플랫폼을 에디터만 체크"
>}}

해결방법은 간단한데, 해당 라이브러리의 `Editor` 폴더 내부에 에디터용 정의 파일을 따로 생성 후, 플랫폼 설정의 `Include Platforms` 설정을 `Editor` 만 허용하도록 변경하면 됩니다.


테스트 실행
-----------


준비가 끝났다면 이제 테스트를 작성하고 에디터에서 실행해보면 됩니다. 결과는 테스트 러너 창에서 바로 확인이 가능합니다.

{{<
figure
  src="test-result.png"
  caption="테스트 실행 결과"
>}}

현재 프로젝트에서도 아직은 테스트가 붙어있지 않은 코드가 더 많지만, 유니티 테스트 러너를 도입한 이후에는 가능하면 버그 수정이나 새로운 기능 추가 시 테스트를 함께 작성하고 있으며, 덕분에 매번 게임을 실행해서 확인해야 했던 연출이나 로직 확인에 많은 시간을 줄일 수 있었습니다.  
유니티를 사용하는 다른 프로젝트에서도 기회가 될 때 도입이 된다면, 생산성 향상에 많은 도움이 될 것이라 생각합니다. 감사합니다!


[Libplanet]: https://github.com/planetarium/libplanet.net
[유니티 테스트 러너]: https://docs.unity3d.com/Manual/testing-editortestsrunner.html
[NUnit]: https://nunit.org/

[^1]: 심지어 PlayMode 테스트는 해당 플랫폼용으로 빌드된 플레이어로 알아서 빌드 후 실행까지 가능합니다.
